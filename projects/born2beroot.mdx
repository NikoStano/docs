---
title: "Born2beroot"
description: "Administration syst√®me et virtualisation"
icon: "server"
---

# üñ•Ô∏è Born2beroot

<img src="https://img.shields.io/badge/Score-125%2F100-success" alt="Score" />
<img src="https://img.shields.io/badge/OS-Rocky%20Linux-blue" alt="OS" />
<img src="https://img.shields.io/badge/Type-SysAdmin-orange" alt="Type" />

## Introduction

**Born2beroot** est votre premier projet d'administration syst√®me. Vous devez cr√©er et configurer une machine virtuelle sous Rocky Linux (ou Debian) avec des politiques de s√©curit√© strictes.

<Note>
Ce projet vous initie aux concepts fondamentaux de l'administration syst√®me Linux : virtualisation, partitionnement, services, s√©curit√© et monitoring.
</Note>

## Objectifs du projet

<Steps>
  <Step title="Cr√©er une VM">
    Installer Rocky Linux sur VirtualBox ou UTM
  </Step>
  
  <Step title="Configurer LVM">
    Mettre en place le Logical Volume Manager avec partitions chiffr√©es
  </Step>
  
  <Step title="S√©curiser le syst√®me">
    Configurer SSH, pare-feu, politique de mots de passe
  </Step>
  
  <Step title="Cr√©er un script monitoring">
    Script bash affichant des informations syst√®me toutes les 10 minutes
  </Step>
</Steps>

## Configuration requise

### Partitionnement obligatoire

```
sda
‚îú‚îÄ‚îÄ sda1       512M    /boot
‚îî‚îÄ‚îÄ sda5       XXXG    Chiffr√© (LVM)
    ‚îî‚îÄ‚îÄ LVMGroup
        ‚îú‚îÄ‚îÄ root    10G     /
        ‚îú‚îÄ‚îÄ swap    2.3G    swap
        ‚îú‚îÄ‚îÄ home    5G      /home
        ‚îú‚îÄ‚îÄ var     3G      /var
        ‚îú‚îÄ‚îÄ srv     3G      /srv
        ‚îú‚îÄ‚îÄ tmp     3G      /tmp
        ‚îî‚îÄ‚îÄ var-log 4G      /var/log
```

<Warning>
La partition principale doit √™tre chiffr√©e avec LUKS. Vous devrez entrer le mot de passe au d√©marrage.
</Warning>

### Services √† configurer

<Accordion title="SSH (Secure Shell)">
  - Port personnalis√© (pas 22)
  - Interdire connexion root
  - Utiliser cl√©s SSH
  
  ```bash
  # /etc/ssh/sshd_config
  Port 4242
  PermitRootLogin no
  PasswordAuthentication no
  ```
</Accordion>

<Accordion title="UFW (Uncomplicated Firewall)">
  - Autoriser uniquement le port SSH
  - Bloquer tout le reste par d√©faut
  
  ```bash
  ufw enable
  ufw allow 4242
  ufw status
  ```
</Accordion>

<Accordion title="Sudo">
  - Configuration stricte
  - Limitation des tentatives
  - Logs des commandes
  
  ```bash
  # /etc/sudoers.d/sudo_config
  Defaults  passwd_tries=3
  Defaults  badpass_message="Wrong password. Try again!"
  Defaults  logfile="/var/log/sudo/sudo.log"
  Defaults  log_input,log_output
  Defaults  requiretty
  ```
</Accordion>

<Accordion title="Politique de mots de passe">
  - Expiration tous les 30 jours
  - Minimum 2 jours avant changement
  - Avertissement 7 jours avant expiration
  - Longueur minimum 10 caract√®res
  - Complexit√© requise
  
  ```bash
  # /etc/login.defs
  PASS_MAX_DAYS 30
  PASS_MIN_DAYS 2
  PASS_WARN_AGE 7
  ```
  
  ```bash
  # /etc/security/pwquality.conf
  minlen = 10
  ucredit = -1
  dcredit = -1
  lcredit = -1
  maxrepeat = 3
  usercheck = 1
  difok = 7
  enforce_for_root
  ```
</Accordion>

## Installation pas √† pas

### 1. Cr√©ation de la VM

<Tabs>
  <Tab title="VirtualBox">
    ```bash
    # Configuration recommand√©e
    Type: Linux
    Version: Red Hat (64-bit)
    RAM: 2048 MB
    Disque: 30 GB (VDI, dynamiquement allou√©)
    
    # R√©seau
    Adaptateur 1: NAT ou Pont
    ```
  </Tab>
  
  <Tab title="UTM (Mac M1/M2)">
    ```bash
    # Configuration
    Type: Linux
    Architecture: ARM64
    RAM: 2048 MB
    Disque: 30 GB
    
    # ISO
    Rocky Linux 9 ARM64
    ```
  </Tab>
</Tabs>

### 2. Installation Rocky Linux

<Steps>
  <Step title="D√©marrage">
    Monter l'ISO Rocky Linux et d√©marrer la VM
  </Step>
  
  <Step title="Langue et clavier">
    S√©lectionner Anglais et disposition clavier
  </Step>
  
  <Step title="Partitionnement manuel">
    Choisir "Custom" pour cr√©er les partitions manuellement
    
    ```
    1. Cr√©er /boot (512M, ext4)
    2. Cr√©er partition chiffr√©e (reste du disque)
    3. Cr√©er volume group LVMGroup
    4. Cr√©er les logical volumes
    ```
  </Step>
  
  <Step title="Chiffrement">
    Activer le chiffrement LUKS sur la partition principale
    
    **Mot de passe fort requis !**
  </Step>
  
  <Step title="Utilisateur">
    - Cr√©er utilisateur (votre login 42)
    - D√©finir mot de passe root
    - NE PAS cr√©er d'utilisateur suppl√©mentaire pendant l'installation
  </Step>
  
  <Step title="Installation minimale">
    Choisir "Minimal Install" - pas d'interface graphique
  </Step>
</Steps>

### 3. Configuration post-installation

#### Mise √† jour du syst√®me

```bash
# Se connecter en root
su -

# Mettre √† jour
dnf update -y

# Installer les outils n√©cessaires
dnf install -y vim sudo ufw
```

#### Configuration sudo

```bash
# Ajouter l'utilisateur au groupe sudo
usermod -aG sudo votre_login

# Cr√©er le fichier de config sudo
visudo -f /etc/sudoers.d/sudo_config
```

Contenu du fichier :
```
Defaults  passwd_tries=3
Defaults  badpass_message="Wrong password!"
Defaults  logfile="/var/log/sudo/sudo.log"
Defaults  log_input,log_output
Defaults  iolog_dir="/var/log/sudo"
Defaults  requiretty
Defaults  secure_path="/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin"
```

#### Configuration SSH

```bash
# Modifier le fichier sshd_config
vim /etc/ssh/sshd_config
```

Modifications :
```bash
Port 4242
PermitRootLogin no
PasswordAuthentication yes  # pour l'√©valuation
```

```bash
# Red√©marrer SSH
systemctl restart sshd

# Activer au d√©marrage
systemctl enable sshd
```

#### Configuration UFW

```bash
# Activer UFW
ufw enable

# Autoriser le port SSH
ufw allow 4242

# V√©rifier
ufw status numbered
```

#### Politique de mots de passe

```bash
# Installer libpwquality
dnf install -y libpwquality

# Modifier login.defs
vim /etc/login.defs
```

```bash
PASS_MAX_DAYS 30
PASS_MIN_DAYS 2
PASS_WARN_AGE 7
```

```bash
# Modifier pwquality.conf
vim /etc/security/pwquality.conf
```

```bash
minlen = 10
ucredit = -1
dcredit = -1
lcredit = -1
maxrepeat = 3
usercheck = 1
difok = 7
enforce_for_root
```

```bash
# Appliquer aux utilisateurs existants
chage -M 30 -m 2 -W 7 votre_login
chage -M 30 -m 2 -W 7 root
```

## Script de monitoring

Le script `monitoring.sh` doit afficher ces informations toutes les 10 minutes via wall :

```bash
#!/bin/bash

# Architecture
arch=$(uname -a)

# CPU physiques
pcpu=$(grep "physical id" /proc/cpuinfo | wc -l)

# CPU virtuels
vcpu=$(grep "processor" /proc/cpuinfo | wc -l)

# M√©moire RAM
ram_total=$(free --mega | awk '$1 == "Mem:" {print $2}')
ram_used=$(free --mega | awk '$1 == "Mem:" {print $3}')
ram_percent=$(free --mega | awk '$1 == "Mem:" {printf("%.2f"), $3/$2*100}')

# Disque
disk_total=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_t += $2} END {printf ("%.1fGb\n"), disk_t/1024}')
disk_used=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_u += $3} END {print disk_u}')
disk_percent=$(df -m | grep "/dev/" | grep -v "/boot" | awk '{disk_u += $3} {disk_t+= $2} END {printf("%d"), disk_u/disk_t*100}')

# CPU load
cpu_load=$(vmstat 1 2 | tail -1 | awk '{printf $15}')
cpu_op=$(expr 100 - $cpu_load)
cpu_fin=$(printf "%.1f" $cpu_op)

# Dernier boot
lb=$(who -b | awk '$1 == "system" {print $3 " " $4}')

# LVM actif
lvmu=$(if [ $(lsblk | grep "lvm" | wc -l) -gt 0 ]; then echo yes; else echo no; fi)

# Connexions TCP
tcpc=$(ss -ta | grep ESTAB | wc -l)

# Nombre d'utilisateurs
ulog=$(users | wc -w)

# Adresse IP et MAC
ip=$(hostname -I)
mac=$(ip link | grep "link/ether" | awk '{print $2}')

# Nombre de commandes sudo
cmds=$(journalctl _COMM=sudo | grep COMMAND | wc -l)

wall "	Architecture: $arch
	CPU physical: $pcpu
	vCPU: $vcpu
	Memory Usage: $ram_used/${ram_total}MB ($ram_percent%)
	Disk Usage: $disk_used/${disk_total} ($disk_percent%)
	CPU load: $cpu_fin%
	Last boot: $lb
	LVM use: $lvmu
	Connections TCP: $tcpc ESTABLISHED
	User log: $ulog
	Network: IP $ip ($mac)
	Sudo: $cmds cmd"
```

### Configuration cron

```bash
# √âditer crontab en root
sudo crontab -e

# Ajouter la ligne
*/10 * * * * /usr/local/bin/monitoring.sh
```

<Tip>
Pour tester sans attendre 10 minutes : `sudo /usr/local/bin/monitoring.sh`
</Tip>

## Commandes essentielles

### Gestion des utilisateurs

```bash
# Cr√©er un utilisateur
sudo adduser username

# Ajouter au groupe
sudo usermod -aG groupname username

# Changer le mot de passe
sudo passwd username

# Voir les groupes d'un utilisateur
groups username

# Lister tous les utilisateurs
cat /etc/passwd

# Politique de mot de passe d'un utilisateur
sudo chage -l username
```

### Gestion des groupes

```bash
# Cr√©er un groupe
sudo groupadd groupname

# Supprimer un groupe
sudo groupdel groupname

# Lister tous les groupes
cat /etc/group

# Voir les membres d'un groupe
getent group groupname
```

### SSH

```bash
# Status du service
sudo systemctl status sshd

# Red√©marrer
sudo systemctl restart sshd

# Se connecter depuis l'h√¥te
ssh votre_login@localhost -p 4242
```

### UFW

```bash
# Status
sudo ufw status numbered

# Ajouter une r√®gle
sudo ufw allow 8080

# Supprimer une r√®gle
sudo ufw delete 2

# D√©sactiver
sudo ufw disable
```

### Hostname

```bash
# Voir le hostname
hostnamectl

# Changer le hostname
sudo hostnamectl set-hostname nouveau_nom

# Modifier aussi /etc/hosts
sudo vim /etc/hosts
```

### LVM

```bash
# Afficher les volumes
sudo lvdisplay

# Afficher les groupes
sudo vgdisplay

# Afficher les partitions physiques
sudo pvdisplay

# R√©sum√©
lsblk
```

## Questions fr√©quentes de d√©fense

<AccordionGroup>
  <Accordion title="Quelle est la diff√©rence entre apt et aptitude ?">
    - **apt** : Interface en ligne de commande simple
    - **aptitude** : Interface plus avanc√©e avec r√©solution de d√©pendances
    
    Sur Rocky Linux, on utilise **dnf** (ou yum)
  </Accordion>
  
  <Accordion title="Qu'est-ce que SELinux / AppArmor ?">
    Syst√®mes de contr√¥le d'acc√®s obligatoire (MAC) qui renforcent la s√©curit√©
    
    - **SELinux** : utilis√© par Rocky Linux/RedHat
    - **AppArmor** : utilis√© par Debian/Ubuntu
  </Accordion>
  
  <Accordion title="Comment fonctionne LVM ?">
    **LVM** (Logical Volume Manager) permet :
    - Redimensionner les partitions √† chaud
    - Cr√©er des snapshots
    - G√©rer plusieurs disques comme un seul volume
    
    Hi√©rarchie : Physical Volume ‚Üí Volume Group ‚Üí Logical Volume
  </Accordion>
  
  <Accordion title="Pourquoi sudo ?">
    - Meilleur audit des commandes
    - Pas besoin du mot de passe root
    - Permissions granulaires
    - Logs des actions
  </Accordion>
  
  <Accordion title="Qu'est-ce qu'UFW ?">
    **Uncomplicated Firewall** : interface simplifi√©e pour iptables
    
    Permet de g√©rer facilement les r√®gles de pare-feu
  </Accordion>
</AccordionGroup>

## Checklist de d√©fense

<Steps>
  <Step title="V√©rifications initiales">
    - [ ] Pas d'interface graphique
    - [ ] SSH fonctionne sur port 4242
    - [ ] UFW actif avec bonnes r√®gles
    - [ ] Partitionnement correct (lsblk)
  </Step>
  
  <Step title="Utilisateurs et groupes">
    - [ ] Cr√©er nouvel utilisateur
    - [ ] Cr√©er groupe "evaluating"
    - [ ] Ajouter utilisateur au groupe
    - [ ] Expliquer politique de mots de passe
  </Step>
  
  <Step title="Hostname et partitions">
    - [ ] Afficher hostname
    - [ ] Modifier hostname
    - [ ] Afficher partitions (lsblk)
    - [ ] Expliquer LVM
  </Step>
  
  <Step title="Sudo">
    - [ ] V√©rifier config sudo
    - [ ] Montrer les logs
    - [ ] Expliquer TTY requirement
  </Step>
  
  <Step title="UFW">
    - [ ] V√©rifier r√®gles
    - [ ] Ajouter/supprimer r√®gle
  </Step>
  
  <Step title="SSH">
    - [ ] V√©rifier config
    - [ ] Expliquer pourquoi pas root
    - [ ] Tester connexion
  </Step>
  
  <Step title="Script monitoring">
    - [ ] Expliquer chaque ligne
    - [ ] Montrer cron
    - [ ] Arr√™ter/d√©marrer cron
  </Step>
</Steps>

## Bonus

<Accordion title="WordPress + Lighttpd + MariaDB + PHP">
  Configuration d'un serveur web complet avec :
  - Lighttpd comme serveur web
  - MariaDB pour la base de donn√©es
  - PHP pour WordPress
  - Configuration sur un port diff√©rent
</Accordion>

<Accordion title="Service suppl√©mentaire">
  Installer et configurer un service utile de votre choix :
  - Fail2ban (protection contre bruteforce)
  - Netdata (monitoring en temps r√©el)
  - Cockpit (interface web d'administration)
</Accordion>

## Ressources

<CardGroup cols={2}>
  <Card title="man sudoers" icon="book">
    ```bash
    man sudoers
    ```
    Configuration compl√®te de sudo
  </Card>
  
  <Card title="Rocky Linux Docs" icon="globe" href="https://docs.rockylinux.org/">
    Documentation officielle
  </Card>
  
  <Card title="LVM Guide" icon="hard-drive" href="https://www.redhat.com/sysadmin/lvm-vs-partitioning">
    Comprendre LVM
  </Card>
  
  <Card title="SSH Hardening" icon="lock" href="https://www.ssh.com/academy/ssh/sshd_config">
    S√©curiser SSH
  </Card>
</CardGroup>

## Conclusion

Born2beroot est votre porte d'entr√©e dans le monde de l'administration syst√®me. Les comp√©tences acquises sont essentielles pour comprendre comment fonctionnent les serveurs Linux.

<Check>
Ce projet vous servira de base pour tous les projets futurs n√©cessitant un serveur ou une VM.
</Check>

<Note>
Prenez le temps de comprendre chaque commande plut√¥t que de simplement copier-coller. L'√©valuation testera votre compr√©hension r√©elle !
</Note>